// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../prisma/generated/client" 
}

datasource db {
  provider = "postgresql"
}




enum UserRole {
  MEMBER
  ADMIN
}

model User {
  id String @default(uuid()) @unique @id
  email String @unique
  name String
  role UserRole @default(MEMBER)

  google_id String? @unique
  phone String?
  avatar_url String?
  bio String?

  password_hash String?
  email_verified Boolean @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  financialAdvisory    FinancialAdvisory[]
  budgetForecasts      BudgetForecastRecord[]
  cashFlowProjections  CashFlowProjectionRecord[]
  scenarioTests        ScenarioTestRecord[]
  riskAssessments      RiskAssessmentRecord[]
  advisoryInsights     AdvisoryInsightRecord[]
  performanceDrivers   PerformanceDriverRecord[]
}

// ─── Financial Advisory ───────────────────────────────────────────────────────

model FinancialAdvisory {
  id String @id @default(uuid())
  user_id String
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  total_financial_health_score    Float  @default(0)
  profitability_trend             String @default("")
  liquidity_score                 Float  @default(0)
  debt_to_equity_ratio            Float  @default(0)
  cash_flow_health                String @default("")

  financial_forecasts             String @default("[]")
  budget_recommendations          String @default("[]")
  cost_optimization_opportunities String @default("[]")
  investment_opportunities        String @default("[]")
  financial_risk_assessment       String @default("[]")
  tax_optimization_strategies     String @default("[]")
  working_capital_management      String @default("[]")
  financial_planning_roadmap      String @default("[]")

  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  @@index([user_id])
}

model BudgetForecastRecord {
  id           String   @id @default(uuid())
  user_id      String
  user         User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  period       String
  type         String   @default("quarterly")
  revenue      Float    @default(0)
  expenses     Float    @default(0)
  net_income   Float    @default(0)
  confidence   Float    @default(85)
  variance     Float    @default(0)
  assumptions  String   @default("[]")
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now())
  @@index([user_id])
}

model CashFlowProjectionRecord {
  id           String   @id @default(uuid())
  user_id      String
  user         User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  period       String
  inflows      Float    @default(0)
  outflows     Float    @default(0)
  net_cash     Float    @default(0)
  cumulative   Float    @default(0)
  category     String   @default("")
  notes        String   @default("")
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now())
  @@index([user_id])
}

model ScenarioTestRecord {
  id           String   @id @default(uuid())
  user_id      String
  user         User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  name         String
  description  String   @default("")
  status       String   @default("pending")
  impact       String   @default("medium")
  probability  Float    @default(0)
  assumptions  String   @default("[]")
  results      String   @default("{}")
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now())
  @@index([user_id])
}

model RiskAssessmentRecord {
  id           String   @id @default(uuid())
  user_id      String
  user         User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  title        String
  category     String   @default("")
  severity     String   @default("medium")
  probability  Float    @default(0)
  impact       String   @default("medium")
  status       String   @default("identified")
  description  String   @default("")
  mitigation   String   @default("")
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now())
  @@index([user_id])
}

model AdvisoryInsightRecord {
  id           String   @id @default(uuid())
  user_id      String
  user         User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  title        String
  category     String   @default("")
  priority     String   @default("medium")
  status       String   @default("pending")
  description  String   @default("")
  action_items String   @default("[]")
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now())
  @@index([user_id])
}

model PerformanceDriverRecord {
  id           String   @id @default(uuid())
  user_id      String
  user         User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  name         String
  category     String   @default("")
  current      Float    @default(0)
  target       Float    @default(0)
  unit         String   @default("")
  trend        String   @default("stable")
  impact       String   @default("medium")
  description  String   @default("")
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now())
  @@index([user_id])
}