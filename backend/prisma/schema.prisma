// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../prisma/generated/client" 
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}




enum UserRole {
  MEMBER
  ADMIN
}

model User {
  id String @default(uuid()) @unique @id
  email String @unique
  name String
  role UserRole @default(MEMBER)

  google_id String? @unique
  phone String?
  avatar_url String?
  bio String?
  campus String?

  password_hash String?
  email_verified Boolean @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  revenueStrategies RevenueStrategy[]
  revenueStreams     RevenueStream[]
  businessForecasts  BusinessForecast[]
}

// ─── Revenue Strategy (reference / future use) ─────────────────────────────────

model RevenueStrategy {
  id                    String    @id @default(uuid())
  user_id               String?
  user                  User?     @relation(fields: [user_id], references: [id])
  financialAdvisory     FinancialAdvisory[]
  budgetForecasts       BudgetForecastRecord[]
  cashFlowProjections   CashFlowProjectionRecord[]
  scenarioTests         ScenarioTestRecord[]
  riskAssessments       RiskAssessmentRecord[]
  advisoryInsights      AdvisoryInsightRecord[]
  performanceDrivers   PerformanceDriverRecord[]
}

// ─── Financial Advisory (reference / future use) ────────────────────────────────

model FinancialAdvisory {
  id               String           @id @default(uuid())
  revenueStrategyId String?
  revenueStrategy   RevenueStrategy? @relation(fields: [revenueStrategyId], references: [id])
  businessForecasts BusinessForecast[]
}

// ─── Stub models for schema validation (reference / future use) ───────────────

model RevenueStream {
  id      String  @id @default(uuid())
  user_id String
  user    User    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model BudgetForecastRecord {
  id                 String          @id @default(uuid())
  revenueStrategyId  String?
  revenueStrategy    RevenueStrategy? @relation(fields: [revenueStrategyId], references: [id])
}

model CashFlowProjectionRecord {
  id                 String          @id @default(uuid())
  revenueStrategyId  String?
  revenueStrategy    RevenueStrategy? @relation(fields: [revenueStrategyId], references: [id])
}

model ScenarioTestRecord {
  id                 String          @id @default(uuid())
  revenueStrategyId  String?
  revenueStrategy    RevenueStrategy? @relation(fields: [revenueStrategyId], references: [id])
}

model RiskAssessmentRecord {
  id                 String          @id @default(uuid())
  revenueStrategyId  String?
  revenueStrategy    RevenueStrategy? @relation(fields: [revenueStrategyId], references: [id])
}

model AdvisoryInsightRecord {
  id                 String          @id @default(uuid())
  revenueStrategyId  String?
  revenueStrategy    RevenueStrategy? @relation(fields: [revenueStrategyId], references: [id])
}

model PerformanceDriverRecord {
  id                 String          @id @default(uuid())
  revenueStrategyId  String?
  revenueStrategy    RevenueStrategy? @relation(fields: [revenueStrategyId], references: [id])
}

// ─── Business Forecasting ─────────────────────────────────────────────────────

model BusinessForecast {
  id                  String            @id @default(uuid())
  user_id             String
  user                User              @relation(fields: [user_id], references: [id], onDelete: Cascade)
  financialAdvisoryId  String?
  financialAdvisory    FinancialAdvisory? @relation(fields: [financialAdvisoryId], references: [id])

  // Headline KPIs
  annual_revenue_target      Float  @default(0)
  customer_segments_count    Int    @default(0)
  kpis_tracked_count         Int    @default(0)
  scenarios_modeled_count    Int    @default(0)
  total_demand_units         Int    @default(0)
  average_order_value        Float  @default(0)
  total_revenue_target       Float  @default(0)
  avg_confidence             Float  @default(0)
  potential_upside           Float  @default(0)
  total_market_opportunity   Float  @default(0)
  weighted_avg_growth        Float  @default(0)
  overall_retention          Float  @default(0)

  // Enterprise segment
  enterprise_units           Int    @default(0)
  enterprise_growth_rate     Float  @default(0)
  enterprise_retention       Float  @default(0)
  enterprise_avg_order       Float  @default(0)
  enterprise_seasonality     Float  @default(0)
  enterprise_revenue_potential Float @default(0)

  // SMB segment
  smb_units                  Int    @default(0)
  smb_growth_rate            Float  @default(0)
  smb_retention              Float  @default(0)
  smb_avg_order              Float  @default(0)
  smb_seasonality            Float  @default(0)
  smb_revenue_potential      Float  @default(0)

  // Q1 2025
  q1_projected_revenue       Float  @default(0)
  q1_actual_to_date          Float  @default(0)
  q1_scenario_min            Float  @default(0)
  q1_scenario_max            Float  @default(0)
  q1_confidence              String @default("Medium")

  // Q2 2025
  q2_projected_revenue       Float  @default(0)
  q2_actual_to_date          Float  @default(0)
  q2_scenario_min            Float  @default(0)
  q2_scenario_max            Float  @default(0)
  q2_confidence              String @default("Medium")

  // Q3 2025
  q3_projected_revenue       Float  @default(0)
  q3_actual_to_date          Float  @default(0)
  q3_scenario_min            Float  @default(0)
  q3_scenario_max            Float  @default(0)
  q3_confidence              String @default("Medium")

  // Q4 2025
  q4_projected_revenue       Float  @default(0)
  q4_actual_to_date          Float  @default(0)
  q4_scenario_min            Float  @default(0)
  q4_scenario_max            Float  @default(0)
  q4_confidence              String @default("Medium")

  // JSON arrays
  kpis               String @default("[]")
  forecast_scenarios String @default("[]")
  documents          String @default("[]")

  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  @@index([user_id])
}